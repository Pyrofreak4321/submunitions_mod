<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <RecipeDef>
    <defName>SM_ExtractPhosphor</defName>
    <label>extract phosphorus from stone chunk</label>
    <description>Use heat and chemicals to extract phosphorus from stone chunks.</description>
    <jobString>extracting phosphorus from stone chunks.</jobString>
    <workAmount>500</workAmount>
    <workSpeedStat>DrugSynthesisSpeed</workSpeedStat>
    <workSkill>Intellectual</workSkill>
		<effectWorking>Cremate</effectWorking>
		<soundWorking>Recipe_Cremate</soundWorking>
    <recipeUsers>
			<li>DrugLab</li>
		</recipeUsers>
    <researchPrerequisite>Submunitions</researchPrerequisite>
    <skillRequirements>
      <Intellectual>8</Intellectual>
    </skillRequirements>
    <ingredients>
      <li>
        <filter>
          <categories>
            <li>StoneChunks</li>
          </categories>
        </filter>
        <count>1</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Neutroamine</li>
          </thingDefs>
        </filter>
        <count>5</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Chemfuel</li>
          </thingDefs>
        </filter>
        <count>5</count>
      </li>
    </ingredients>
    <products>
      <SM_partWP>10</SM_partWP>
    </products>
    <fixedIngredientFilter>
      <categories>
				<li>StoneChunks</li>
			</categories>
      <thingDefs>
        <li>Neutroamine</li>
        <li>Chemfuel</li>
      </thingDefs>
    </fixedIngredientFilter>
  </RecipeDef>

  <DamageDef Name="WhitePhospher" ParentName="Flame">
    <defName>WhitePhospher</defName>
    <workerClass>Submunition.DamageWorker_Inc</workerClass>
    <label>burn</label>
    <hasForcefulImpact>false</hasForcefulImpact>
    <makesBlood>false</makesBlood>
    <canInterruptJobs>true</canInterruptJobs>
    <externalViolence>true</externalViolence>
    <deathMessage>{0} has burned to death.</deathMessage>
    <hediff>Burn</hediff>
    <additionalHediffs>
      <li>
        <hediff>ToxicBuildup</hediff>
        <severityPerDamageDealt>0.001</severityPerDamageDealt>
        <victimSeverityScaling>ToxicSensitivity</victimSeverityScaling>
      </li>
    </additionalHediffs>
    <minDamageToFragment>1</minDamageToFragment>
    <defaultDamage>10</defaultDamage>
    <defaultArmorPenetration>999</defaultArmorPenetration>
    <explosionHeatEnergyPerCell>999</explosionHeatEnergyPerCell>
    <explosionCellMote>Mote_BlastDry</explosionCellMote>
    <explosionColorCenter>(1, 1, 1)</explosionColorCenter>
    <explosionColorEdge>(1, 1, 1)</explosionColorEdge>
    <soundExplosion>Explosion_Smoke</soundExplosion>
    <combatLogRules>Damage_Flame</combatLogRules>
    <canUseDeflectMetalEffect>false</canUseDeflectMetalEffect>
  </DamageDef>

  <DamageDef Name="WhitePhospherFlash" ParentName="WhitePhospher">
    <defName>WhitePhospherFlash</defName>
    <hediff>SM_WP_Burn</hediff>
    <additionalHediffs>
      <li>
        <hediff>FlashBlind</hediff>
        <severityPerDamageDealt>0.1</severityPerDamageDealt>
      </li>
      <li>
        <hediff>ToxicBuildup</hediff>
        <severityPerDamageDealt>0.01</severityPerDamageDealt>
        <victimSeverityScaling>ToxicSensitivity</victimSeverityScaling>
      </li>
    </additionalHediffs>
 </DamageDef>

  <ThingDef ParentName="ResourceBase">
    <defName>SM_partWP</defName>
    <label>White Phosphorus</label>
    <description>Highly flammable White Phosphorus.</description>
    <graphicData>
      <texPath>Submunition/Item/SM_partWP</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <tickerType>Normal</tickerType>
    <comps>
      <li Class="CompProperties_Explosive">
        <wickTicks>
          <min>1</min>
          <max>5</max>
        </wickTicks>
        <explosiveRadius>1</explosiveRadius>
        <explosiveDamageType>WhitePhospherFlash</explosiveDamageType>
        <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
        <postExplosionSpawnChance>0.75</postExplosionSpawnChance>
        <explosiveExpandPerStackcount>.5</explosiveExpandPerStackcount>
        <startWickHitPointsPercent>0.9</startWickHitPointsPercent>
      </li>
    </comps>
    <stackLimit>200</stackLimit>
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <MarketValue>4</MarketValue>
      <Mass>0.02</Mass>
      <Flammability>2</Flammability>
      <DeteriorationRate>5</DeteriorationRate>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
  </ThingDef>

  <ThingDef ParentName="BaseGas">
    <thingClass>Submunition.Gas_Toxic</thingClass>
    <defName>SM_Gas_WP</defName>
    <label>White Phosphorus debries</label>
    <graphicData>
      <texPath>Things/Gas/Puff</texPath>
      <drawSize>0.1</drawSize>
      <color>(1.0,1.0,1.0, 0.1)</color>
    </graphicData>
    <gas>
      <expireSeconds>
        <min>10</min>
        <max>30</max>
      </expireSeconds>
      <blockTurretTracking>false</blockTurretTracking>
      <accuracyPenalty>0</accuracyPenalty>
      <rotationSpeed>9999</rotationSpeed>
    </gas>
    <modExtensions>
      <li Class="Submunition.DefToxicGasExtension">
        <toxicGasSmokey>10</toxicGasSmokey>
        <toxicGasHot>true</toxicGasHot>
        
        <toxicGasDamageChance>1</toxicGasDamageChance>
        <toxicGasDamageStrength>5</toxicGasDamageStrength>
        <toxicGasDamageDef>WhitePhospher</toxicGasDamageDef>
        <toxicGasDamageEnviro>true</toxicGasDamageEnviro>
        <toxicGasArea>true</toxicGasArea>
        <!--<toxicGasDamageResist>ArmorRating_Heat</toxicGasDamageResist>-->
      </li>
    </modExtensions>
  </ThingDef>
  
  
  <ThingDef ParentName="TrapIEDBase">
    <defName>TrapIED_WP</defName>
    <label>White Phosphorus IED trap</label>
    <description>A pair of white phosphorus shells connected to a touch-activated trigger. Since it is hidden in the surrounding terrain, it cannot be placed adjacent to other traps. Animals can sense these when calm.</description>
    <graphicData>
      <texPath>Submunition/Item/IED_WP</texPath>
    </graphicData>
    <costList>
      <Shell_White_Phospher>2</Shell_White_Phospher>
    </costList>
    <comps>
      <li Class="CompProperties_Explosive">
        <explosiveDamageType>WhitePhospherFlash</explosiveDamageType>
        <explosiveRadius>8</explosiveRadius>
        <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
        <postExplosionSpawnChance>0.35</postExplosionSpawnChance>
        <startWickHitPointsPercent>0.2</startWickHitPointsPercent>
        <wickTicks>
          <min>15</min>
          <max>15</max>
        </wickTicks>
      </li>
    </comps>
    <specialDisplayRadius>8</specialDisplayRadius>
  </ThingDef>  
  
  
  <ThingDef ParentName="MakeableShellBase">
    <defName>Shell_White_Phospher</defName>
    <label>white phosphorus shell</label>
    <description>A mortar shell loaded with white phosphorus. White phosphorus burns extreamly bright potentaly blinding anyone nearby, it also releases a toxic gas.</description>
    <graphicData>
      <texPath>Submunition/Item/Shell_WP</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <comps>
      <li Class="CompProperties_Explosive">
        <explosiveRadius>.5</explosiveRadius>
        <explosiveDamageType>WhitePhospherFlash</explosiveDamageType>
        <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
        <postExplosionSpawnChance>0.5</postExplosionSpawnChance>
        <explosiveExpandPerStackcount>.35</explosiveExpandPerStackcount>
        <startWickHitPointsPercent>0.7</startWickHitPointsPercent>
        <wickTicks>
          <min>30</min>
          <max>60</max>
        </wickTicks>
      </li>
    </comps>
    <projectileWhenLoaded>Bullet_Shell_White_Phospher</projectileWhenLoaded>
    <costList>
      <Steel>20</Steel>
      <Chemfuel>20</Chemfuel>
      <SM_partWP>100</SM_partWP>
    </costList>
    <recipeMaker>
      <workAmount>2000</workAmount>
      <researchPrerequisite>Submunitions</researchPrerequisite>
      <skillRequirements>
        <Crafting>8</Crafting>
      </skillRequirements>
    </recipeMaker>
    <statBases>
      <MaxHitPoints>60</MaxHitPoints>
      <MarketValue>400</MarketValue>
      <Mass>7</Mass>
    </statBases>
    <thingSetMakerTags>
      <li>RewardSpecial</li>
    </thingSetMakerTags>
  </ThingDef>
  <ThingDef ParentName="BaseBullet">
    <defName>Bullet_Shell_White_Phospher</defName>
    <label>white phosphorus shell</label>
    <graphicData>
      <texPath>Submunition/Item/Bullet_Shell_WP</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <shaderType>TransparentPostLight</shaderType>
    </graphicData>
    <thingClass>Projectile_Explosive</thingClass>
    <projectile>
      <damageDef>WhitePhospherFlash</damageDef>
      <speed>41</speed>
      <explosionRadius>6</explosionRadius>
      <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
      <postExplosionSpawnChance>0.15</postExplosionSpawnChance>
      <flyOverhead>true</flyOverhead>
      <soundHitThickRoof>Artillery_HitThickRoof</soundHitThickRoof>
      <soundExplode>MortarBomb_Explode</soundExplode>
      <soundImpactAnticipate>MortarRound_PreImpact</soundImpactAnticipate>
      <soundAmbient>MortarRound_Ambient</soundAmbient>
      <ai_IsIncendiary>true</ai_IsIncendiary>
    </projectile>
  </ThingDef>
    
	<ThingDef ParentName="BaseMakeableGrenade">
		<defName>SM_Weapon_Grenade_WP</defName>
		<label>white phosphorus grenades</label>
		<description>A White Phosphorus grenade. it can be thrown a short distance, where it'll explode.</description>
    <tickerType>Normal</tickerType>
		<graphicData>
			<texPath>Submunition/Item/SM_Weapon_Grenade_WP</texPath>
			<graphicClass>Graphic_Single</graphicClass>
		</graphicData>
		<soundInteract>Interact_Grenade</soundInteract>
		<techLevel>Industrial</techLevel>
    <recipeMaker>
      <researchPrerequisite>Submunitions</researchPrerequisite>
      <skillRequirements>
        <Crafting>8</Crafting>
      </skillRequirements>
    </recipeMaker>
		<statBases>
			<Mass>1</Mass>
			<RangedWeapon_Cooldown>2.66</RangedWeapon_Cooldown>
      <WorkToMake>20000</WorkToMake>
    </statBases>
    <costList>
      <Steel>20</Steel>
      <Chemfuel>20</Chemfuel>
      <SM_partWP>400</SM_partWP>
    </costList>
    <weaponTags>
      <li>GrenadeDestructive</li>
    </weaponTags>
		<thingCategories>
			<li>Grenades</li>
		</thingCategories>
		<verbs>
			<li>
				<label>throw white phosphorus grenade</label>
				<verbClass>Verb_LaunchProjectile</verbClass>
				<hasStandardCommand>true</hasStandardCommand>
				<range>12.9</range>
				<forcedMissRadius>1.9</forcedMissRadius>
				<warmupTime>1.5</warmupTime>
				<noiseRadius>4</noiseRadius>
				<ai_IsBuildingDestroyer>false</ai_IsBuildingDestroyer>
				<soundCast>ThrowGrenade</soundCast>
				<targetParams>
					<canTargetLocations>true</canTargetLocations>
				</targetParams>
				<defaultProjectile>SM_Proj_Grenade_WP</defaultProjectile>
        <rangedFireRulepack>Combat_RangedFire_Thrown</rangedFireRulepack>
			</li>
		</verbs>
    <comps>
      <li Class="CompProperties_Explosive">
        <requiredDamageTypeToExplode>Flame</requiredDamageTypeToExplode>
        <explosiveDamageType>WhitePhospherFlash</explosiveDamageType>
        <explosiveRadius>2</explosiveRadius>
        <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
        <postExplosionSpawnChance>0.15</postExplosionSpawnChance>
      </li>
    </comps>
	</ThingDef>
	<ThingDef ParentName="BaseGrenadeProjectile">
		<defName>SM_Proj_Grenade_WP</defName>
		<label>white phosphorus grenade</label>
		<thingClass>Projectile_Explosive</thingClass>
		<graphicData>
			<texPath>Submunition/Item/Proj_Grenade_WP</texPath>
			<graphicClass>Graphic_Single</graphicClass>
		</graphicData>
		<projectile>
      <!-- Use default damage from explosion def -->
			<explosionDelay>50</explosionDelay>    
      <damageDef>WhitePhospherFlash</damageDef>
      <explosionRadius>2</explosionRadius>
      <postExplosionSpawnThingDef>SM_Gas_WP</postExplosionSpawnThingDef>
      <postExplosionSpawnChance>0.55</postExplosionSpawnChance>
		</projectile>
	</ThingDef>
  
</Defs>